<!DOCTYPE html>
<html lang="zh-TW">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>NTCU äº’åŠ©æœƒ</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <style>
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
Â  Â  Â  Â  body { font-family: 'Noto Sans TC', sans-serif; background: #f8fafc; }
Â  Â  Â  Â  .map-container {
Â  Â  Â  Â  Â  Â  position: relative; width: 100%; height: 600px;
Â  Â  Â  Â  Â  Â  background: #e2e8f0 url('https://i.ibb.co/DPQm11wf/1.png') no-repeat center/contain;
Â  Â  Â  Â  Â  Â  border-radius: 2.5rem; border: 8px solid white; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
Â  Â  Â  Â  Â  Â  overflow: hidden; cursor: crosshair;
Â  Â  Â  Â  }
Â  Â  Â  Â  #shapes-layer, #pins-layer { position: absolute; inset: 0; pointer-events: none; }
Â  Â  Â  Â  #shapes-layer { z-index: 80; }
Â  Â  Â  Â  #pins-layer { z-index: 90; }
Â  Â  Â  Â  .building-shape { position: absolute; transform-origin: center; pointer-events: auto; background: transparent; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* ä¸‰è§’å½¢ CSS ç¹ªè£½æ”¯æ´ (é è¦½ç”¨) */
Â  Â  Â  Â  .s-triangle {Â 
Â  Â  Â  Â  Â  Â  clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
Â  Â  Â  Â  Â  Â  background: transparent;
Â  Â  Â  Â  }

Â  Â  Â  Â  .floating-pin {Â 
Â  Â  Â  Â  Â  Â  position: absolute; transform: translate(-50%, -50%);Â 
Â  Â  Â  Â  Â  Â  cursor: pointer; pointer-events: auto; z-index: 100;
Â  Â  Â  Â  }
Â  Â  Â  Â  .pin-dot {
Â  Â  Â  Â  Â  Â  width: 16px; height: 16px; border-radius: 50%; border: 2px solid white;
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 10px rgba(0,0,0,0.2); animation: pulse 2s infinite;
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes pulse {
Â  Â  Â  Â  Â  Â  0% { box-shadow: 0 0 0 0px rgba(79, 70, 229, 0.4); transform: scale(1); }
Â  Â  Â  Â  Â  Â  70% { box-shadow: 0 0 0 10px rgba(79, 70, 229, 0); transform: scale(1.1); }
Â  Â  Â  Â  Â  Â  100% { box-shadow: 0 0 0 0px rgba(79, 70, 229, 0); transform: scale(1); }
Â  Â  Â  Â  }
Â  Â  Â  Â  .tab-active { background-color: #4f46e5; color: white; }
Â  Â  Â  Â  .tab-lost-active { background-color: #ef4444; color: white; }
Â  Â  </style>
</head>
<body class="p-4 md:p-8">

Â  Â  <div class="max-w-6xl mx-auto">
Â  Â  Â  Â  <header class="flex justify-between items-center mb-8">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-3xl font-black text-slate-800">ğŸ’ NTCU ä¸€ä¸Ÿä¸€æ’¿</h1>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-slate-500 text-sm">é»æ“Šåœ°åœ–æ¨™è¨»ï¼š<span class="text-indigo-600 font-bold">è—è‰²æ‹¾ç²</span> / <span class="text-red-500 font-bold">ç´…è‰²éºå¤±</span></p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="bg-white p-3 px-6 rounded-3xl shadow-sm border border-slate-100">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-[9px] font-black text-slate-400 block text-right">TOP HERO</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="top-hero-name" class="text-xl font-black text-indigo-600">è¼‰å…¥ä¸­...</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
Â  Â  Â  Â  Â  Â  <div class="lg:col-span-8">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="map-root" class="map-container" onclick="handleMapClick(event)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="shapes-layer"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="pins-layer"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="lg:col-span-4 flex flex-col gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-indigo-600 rounded-[2.5rem] p-6 text-white shadow-xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold mb-4 text-sm">ğŸ† åŠŸå¾·æ¦œ</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="leaderboard" class="space-y-3 text-xs"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white rounded-[2.5rem] shadow-sm border h-[400px] flex flex-col overflow-hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-5 border-b bg-slate-50 font-black text-slate-600 text-sm flex justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>æœ€æ–°å‹•æ…‹</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="items-count" class="text-indigo-500">0</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="items-list" class="flex-1 overflow-y-auto p-4 space-y-3"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="report-modal" class="fixed inset-0 bg-slate-900/40 hidden flex items-center justify-center z-[300] p-4 backdrop-blur-sm">
Â  Â  Â  Â  <div class="bg-white rounded-[2.5rem] max-w-sm w-full p-6 shadow-2xl text-center">
Â  Â  Â  Â  Â  Â  <div class="flex bg-slate-100 p-1 rounded-2xl mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="switchTab('found')" id="tab-found" class="flex-1 py-2 rounded-xl font-black text-sm tab-active">æ’¿åˆ°æ±è¥¿</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="switchTab('lost')" id="tab-lost" class="flex-1 py-2 rounded-xl font-black text-sm text-slate-400">éºå¤±ç‰©å“</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="mb-5"><div id="location-name" class="inline-block px-4 py-1.5 bg-indigo-50 text-indigo-700 text-base font-black rounded-2xl">å®šä½ä¸­...</div></div>
Â  Â  Â  Â  Â  Â  <div class="space-y-3 mb-6 text-left">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="in-nick" placeholder="æš±ç¨±(å¿…å¡«)" class="w-full px-5 py-3 bg-slate-50 border rounded-2xl font-bold outline-none">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="in-item" placeholder="ç‰©å“åç¨±(å¿…å¡«)" class="w-full px-5 py-3 bg-slate-50 border rounded-2xl font-bold outline-none">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="in-floor" placeholder="å…·é«”æè¿° (ä¾‹ï¼šA302ã€çƒå ´)" class="w-full px-5 py-3 bg-slate-50 border rounded-2xl font-bold outline-none">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-3 border-2 border-dashed border-slate-200 rounded-2xl cursor-pointer text-center" onclick="document.getElementById('in-file').click()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="in-file" accept="image/*" class="hidden" onchange="previewImage(this)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="preview-container" class="hidden"><img id="img-preview" src="" class="rounded-xl mx-auto max-h-24 object-cover"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="upload-placeholder" class="text-slate-400 text-[10px]">ğŸ“· æ‹ç…§ä¸Šå‚³ (é¸å¡«)</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button id="btn-submit" class="w-full py-4 bg-indigo-600 text-white font-black rounded-2xl shadow-lg">ç¢ºèª(ç²å¾—50åŠŸå¾·å€¼)</button>
Â  Â  Â  Â  Â  Â  <button onclick="closeModals()" class="mt-4 text-slate-400 font-bold text-xs">å–æ¶ˆ</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="detail-modal" class="fixed inset-0 bg-slate-900/60 hidden flex items-center justify-center z-[400] p-4 backdrop-blur-md">
Â  Â  Â  Â  <div class="bg-white rounded-[2.5rem] max-w-sm w-full overflow-hidden shadow-2xl flex flex-col max-h-[90vh]">
Â  Â  Â  Â  Â  Â  <div id="detail-header-color" class="w-full bg-slate-100 flex items-center justify-center relative min-h-[150px]">
Â  Â  Â  Â  Â  Â  Â  Â  <img id="detail-img" src="" class="w-full h-auto max-h-[50vh] object-contain block">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="no-img-placeholder" class="hidden text-slate-300 font-bold text-sm py-20">ğŸ“· ç„¡ç…§ç‰‡é è¦½</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="type-tag" class="absolute top-4 left-4 px-4 py-1 rounded-full text-[10px] font-black text-white z-10 shadow-md"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="p-6 overflow-y-auto">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 id="detail-name" class="text-2xl font-black text-slate-800">ç‰©å“åç¨±</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p id="detail-loc" class="text-slate-400 font-bold text-sm mb-4">ğŸ“ ä½ç½®</p>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-slate-50 rounded-xl p-3 border-l-4 border-indigo-500 mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-[9px] text-slate-400 font-black">å…·é«”æè¿°</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="detail-floor" class="font-bold text-sm text-slate-700"></p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="btn-claim-now" class="flex-1 py-4 bg-emerald-500 text-white font-black rounded-2xl">é€™æ˜¯æˆ‘çš„</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="closeDetail()" class="px-6 py-4 bg-slate-100 text-slate-400 font-bold rounded-2xl">é—œé–‰</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script type="module">
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
Â  Â  Â  Â  import { getFirestore, doc, setDoc, getDoc, collection, onSnapshot, deleteDoc, increment, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

Â  Â  Â  Â  const firebaseConfig = {
Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyDnKRElPR1agzd5Lknzbqrv9kJtiD_bKsY",
Â  Â  Â  Â  Â  Â  authDomain: "lostandnotfound-6d007.firebaseapp.com",
Â  Â  Â  Â  Â  Â  projectId: "lostandnotfound-6d007",
Â  Â  Â  Â  Â  Â  storageBucket: "lostandnotfound-6d007.firebasestorage.app",
Â  Â  Â  Â  Â  Â  messagingSenderId: "456947474024",
Â  Â  Â  Â  Â  Â  appId: "1:456947474024:web:18382370a1f9ca5c0765dd"
Â  Â  Â  Â  };

Â  Â  Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  Â  Â  const db = getFirestore(app);
Â  Â  Â  Â  const LOST_COLL = collection(db, "all_reports_v3");
Â  Â  Â  Â  const USER_COLL = collection(db, "users_v2");
Â  Â  Â  Â  const CAMPUS_DOC = doc(db, "campus_data", "NTCU-CAMPUS-V2");

Â  Â  Â  Â  let currentTab = 'found', buildings = [], reports = [], clickPos = {x:50, y:50};

Â  Â  Â  Â  // ä¸‰è§’å½¢åˆ¤å®šå‡½æ•¸ (é¢ç©æ³•)
Â  Â  Â  Â  function isPointInTriangle(px, py, x1, y1, x2, y2, x3, y3) {
Â  Â  Â  Â  Â  Â  const area = Math.abs((x1*(y2-y3) + x2*(y3-y1) + x3*(y1-y2))/2);
Â  Â  Â  Â  Â  Â  const a1 = Math.abs((px*(y1-y2) + x1*(y2-py) + x2*(py-y1))/2);
Â  Â  Â  Â  Â  Â  const a2 = Math.abs((px*(y2-y3) + x2*(y3-py) + x3*(py-y2))/2);
Â  Â  Â  Â  Â  Â  const a3 = Math.abs((px*(y3-y1) + x3*(y1-py) + x1*(py-y3))/2);
Â  Â  Â  Â  Â  Â  return Math.abs(area - (a1 + a2 + a3)) < 0.01;
Â  Â  Â  Â  }

Â  Â  Â  Â  function isPointInShape(px, py, box) {
Â  Â  Â  Â  Â  Â  const angleRad = (box.angle || 0) * Math.PI / 180;
Â  Â  Â  Â  Â  Â  const cx = box.x + box.w / 2, cy = box.y + box.h / 2;
Â  Â  Â  Â  Â  Â  const cos = Math.cos(-angleRad), sin = Math.sin(-angleRad);
Â  Â  Â  Â  Â  Â  const rx = cos * (px - cx) - sin * (py - cy);
Â  Â  Â  Â  Â  Â  const ry = sin * (px - cx) + cos * (py - cy);

Â  Â  Â  Â  Â  Â  if (box.type === 'rect') return Math.abs(rx) <= box.w/2 && Math.abs(ry) <= box.h/2;
Â  Â  Â  Â  Â  Â  if (box.type === 'ellipse') return (rx*rx)/((box.w/2)**2) + (ry*ry)/((box.h/2)**2) <= 1;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ä¸‰è§’å½¢åˆ¤å®šï¼šå‡è¨­é»æ˜¯åœ¨å€åŸŸå…§çš„æ¯”ä¾‹åº§æ¨™
Â  Â  Â  Â  Â  Â  if (box.type === 'triangle') {
Â  Â  Â  Â  Â  Â  Â  Â  // å®šç¾©ä¸‰è§’å½¢çš„ä¸‰å€‹é ‚é» (ä»¥ä¸­å¿ƒæ—‹è½‰å¾Œçš„ç›¸å°ä½ç½®)
Â  Â  Â  Â  Â  Â  Â  Â  const x1 = 0, y1 = -box.h/2; // é ‚
Â  Â  Â  Â  Â  Â  Â  Â  const x2 = -box.w/2, y2 = box.h/2; // å·¦ä¸‹
Â  Â  Â  Â  Â  Â  Â  Â  const x3 = box.w/2, y3 = box.h/2; // å³ä¸‹
Â  Â  Â  Â  Â  Â  Â  Â  return isPointInTriangle(rx, ry, x1, y1, x2, y2, x3, y3);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (box.type === 'capsule') {
Â  Â  Â  Â  Â  Â  Â  Â  const r = Math.min(box.w, box.h) / 2;
Â  Â  Â  Â  Â  Â  Â  Â  if (box.w >= box.h) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const l = box.w - 2 * r;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (Math.abs(ry) <= r && Math.abs(rx) <= l/2) return true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return ((Math.abs(rx) - l/2)**2 + ry*ry) <= r*r;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  }

Â  Â  Â  Â  window.handleMapClick = (e) => {
Â  Â  Â  Â  Â  Â  const r = document.getElementById('map-root').getBoundingClientRect();
Â  Â  Â  Â  Â  Â  clickPos = { x:((e.clientX-r.left)/r.width)*100, y:((e.clientY-r.top)/r.height)*100 };
Â  Â  Â  Â  Â  Â  let hit = buildings.find(b => isPointInShape(clickPos.x, clickPos.y, b));
Â  Â  Â  Â  Â  Â  document.getElementById('location-name').innerText = `ğŸ“ ${hit ? hit.name : "æ ¡åœ’é–‹æ”¾å€åŸŸ"}`;
Â  Â  Â  Â  Â  Â  document.getElementById('report-modal').classList.remove('hidden');
Â  Â  Â  Â  };

Â  Â  Â  Â  // Firebase ç›£è½èˆ‡æ¸²æŸ“
Â  Â  Â  Â  onSnapshot(CAMPUS_DOC, (snap) => { if (snap.exists()) { buildings = snap.data().buildings || []; renderShapes(); } });
Â  Â  Â  Â  onSnapshot(LOST_COLL, (s) => {Â 
Â  Â  Â  Â  Â  Â  reports = s.docs.map(d => ({ id: d.id, ...d.data() }));Â 
Â  Â  Â  Â  Â  Â  document.getElementById('items-count').innerText = reports.length;
Â  Â  Â  Â  Â  Â  renderPins(); renderList();Â 
Â  Â  Â  Â  });
Â  Â  Â  Â  onSnapshot(query(USER_COLL, orderBy("merit", "desc"), limit(5)), (s) => {
Â  Â  Â  Â  Â  Â  document.getElementById('leaderboard').innerHTML = s.docs.map((d, i) => `<div class="flex justify-between p-2 bg-white/10 rounded-xl"><span>${i+1}. ${d.id}</span><b>${d.data().merit || 0} pts</b></div>`).join('');
Â  Â  Â  Â  Â  Â  if(s.docs[0]) document.getElementById('top-hero-name').innerText = s.docs[0].id;
Â  Â  Â  Â  });

Â  Â  Â  Â  document.getElementById('btn-submit').onclick = async () => {
Â  Â  Â  Â  Â  Â  const nick = document.getElementById('in-nick').value.trim();
Â  Â  Â  Â  Â  Â  const item = document.getElementById('in-item').value.trim();
Â  Â  Â  Â  Â  Â  if(!nick || !item) return alert("æš±ç¨±èˆ‡ç‰©å“ç‚ºå¿…å¡«");
Â  Â  Â  Â  Â  Â  await setDoc(doc(LOST_COLL), {Â 
Â  Â  Â  Â  Â  Â  Â  Â  type: currentTab, name: item, finder: nick,Â 
Â  Â  Â  Â  Â  Â  Â  Â  floor_info: document.getElementById('in-floor').value,
Â  Â  Â  Â  Â  Â  Â  Â  location: document.getElementById('location-name').innerText.replace('ğŸ“ ',''),
Â  Â  Â  Â  Â  Â  Â  Â  imageUrl: document.getElementById('img-preview').src.startsWith('data:image') ? document.getElementById('img-preview').src : "",
Â  Â  Â  Â  Â  Â  Â  Â  x: clickPos.x, y: clickPos.y, time: Date.now()Â 
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  if(currentTab === 'found') await setDoc(doc(USER_COLL, nick), { merit: increment(50) }, { merge: true });
Â  Â  Â  Â  Â  Â  closeModals();
Â  Â  Â  Â  };

Â  Â  Â  Â  window.openDetail = (id) => {
Â  Â  Â  Â  Â  Â  const item = reports.find(i => i.id === id); if(!item) return;
Â  Â  Â  Â  Â  Â  const tag = document.getElementById('type-tag');
Â  Â  Â  Â  Â  Â  tag.innerText = item.type === 'found' ? 'æ‹¾ç²ç‰©' : 'å”å°‹ä¸­';
Â  Â  Â  Â  Â  Â  tag.className = `absolute top-4 left-4 px-4 py-1 rounded-full text-[10px] font-black text-white z-10 ${item.type==='found'?'bg-indigo-600':'bg-red-500'}`;
Â  Â  Â  Â  Â  Â  document.getElementById('detail-name').innerText = item.name;
Â  Â  Â  Â  Â  Â  document.getElementById('detail-loc').innerText = `ğŸ“ ${item.location}`;
Â  Â  Â  Â  Â  Â  document.getElementById('detail-floor').innerText = item.floor_info || "å°šæœªæä¾›å…·é«”æè¿°";
Â  Â  Â  Â  Â  Â  const img = document.getElementById('detail-img'), ph = document.getElementById('no-img-placeholder');
Â  Â  Â  Â  Â  Â  if(item.imageUrl) { img.src = item.imageUrl; img.classList.remove('hidden'); ph.classList.add('hidden'); }
Â  Â  Â  Â  Â  Â  else { img.classList.add('hidden'); ph.classList.remove('hidden'); }
Â  Â  Â  Â  Â  Â  document.getElementById('btn-claim-now').onclick = () => claimItem(item.id, item.finder, item.type);
Â  Â  Â  Â  Â  Â  document.getElementById('detail-modal').classList.remove('hidden');
Â  Â  Â  Â  };

Â  Â  Â  Â  window.claimItem = async (id, f, type) => {
Â  Â  Â  Â  Â  Â  if(confirm('ç¢ºèªè™•ç†å®Œæˆï¼Ÿ')) {
Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, "all_reports_v3", id));
Â  Â  Â  Â  Â  Â  Â  Â  if(type === 'found') await setDoc(doc(USER_COLL, f), { merit: increment(20) }, { merge: true });
Â  Â  Â  Â  Â  Â  Â  Â  closeDetail();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  window.switchTab = (t) => {
Â  Â  Â  Â  Â  Â  currentTab = t;
Â  Â  Â  Â  Â  Â  document.getElementById('tab-found').className = t==='found' ? "flex-1 py-2 rounded-xl font-black text-sm tab-active" : "flex-1 py-2 rounded-xl font-black text-sm text-slate-400";
Â  Â  Â  Â  Â  Â  document.getElementById('tab-lost').className = t==='lost' ? "flex-1 py-2 rounded-xl font-black text-sm tab-lost-active" : "flex-1 py-2 rounded-xl font-black text-sm text-slate-400";
Â  Â  Â  Â  };

Â  Â  Â  Â  function renderShapes() {
Â  Â  Â  Â  Â  Â  const layer = document.getElementById('shapes-layer'); layer.innerHTML = '';
Â  Â  Â  Â  Â  Â  buildings.forEach(b => {
Â  Â  Â  Â  Â  Â  Â  Â  const el = document.createElement('div'); el.className = `building-shape s-${b.type}`;
Â  Â  Â  Â  Â  Â  Â  Â  el.style.cssText = `left:${b.x}%; top:${b.y}%; width:${b.w}%; height:${b.h}%; transform:rotate(${b.angle||0}deg);`;
Â  Â  Â  Â  Â  Â  Â  Â  layer.appendChild(el);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderPins() {
Â  Â  Â  Â  Â  Â  const layer = document.getElementById('pins-layer'); layer.innerHTML = '';
Â  Â  Â  Â  Â  Â  reports.forEach(i => {
Â  Â  Â  Â  Â  Â  Â  Â  const p = document.createElement('div'); p.className = 'floating-pin';
Â  Â  Â  Â  Â  Â  Â  Â  p.style.left = `${i.x}%`; p.style.top = `${i.y}%`;
Â  Â  Â  Â  Â  Â  Â  Â  const dotColor = i.type === 'found' ? 'bg-indigo-600' : 'bg-red-500';
Â  Â  Â  Â  Â  Â  Â  Â  p.innerHTML = `<div class="pin-dot ${dotColor}"></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  p.onclick = (e) => { e.stopPropagation(); openDetail(i.id); };
Â  Â  Â  Â  Â  Â  Â  Â  layer.appendChild(p);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderList() {
Â  Â  Â  Â  Â  Â  document.getElementById('items-list').innerHTML = reports.sort((a,b)=>b.time-a.time).map(i => `
Â  Â  Â  Â  Â  Â  Â  Â  <div onclick="openDetail('${i.id}')" class="p-3 bg-white rounded-2xl border-l-4 ${i.type==='found'?'border-indigo-500':'border-red-500'} flex items-center gap-3 cursor-pointer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-10 h-10 bg-slate-100 rounded-lg flex-shrink-0 flex items-center justify-center overflow-hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${i.imageUrl ? `<img src="${i.imageUrl}" class="w-full h-full object-cover">` : 'ğŸ'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1 truncate"><div class="font-bold text-sm">${i.name}</div><div class="text-[9px] text-slate-400">ğŸ“ ${i.location}</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>`).join('');
Â  Â  Â  Â  }

Â  Â  Â  Â  window.previewImage = (input) => {
Â  Â  Â  Â  Â  Â  const f = input.files[0]; if(!f) return;
Â  Â  Â  Â  Â  Â  const r = new FileReader(); r.onload = e => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('img-preview').src = e.target.result;Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('preview-container').classList.remove('hidden');Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('upload-placeholder').classList.add('hidden');Â 
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  r.readAsDataURL(f);
Â  Â  Â  Â  };
Â  Â  Â  Â  window.closeModals = () => document.getElementById('report-modal').classList.add('hidden');
Â  Â  Â  Â  window.closeDetail = () => document.getElementById('detail-modal').classList.add('hidden');
Â  Â  </script>
</body>
</html>
